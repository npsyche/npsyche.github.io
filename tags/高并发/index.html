<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>苏三个人技术博客  | 高并发</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" />
    <link rel="stylesheet" href="https://npsyche.github.io/css/blog.css" />
    <link rel="alternate" type="application/rss+xml" href="https://npsyche.github.io/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/index.xml" title="苏三个人技术博客" />
    </head>
<body>

    
    <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://npsyche.github.io/">Home</a>
        </div>
    </nav>
    

    
    <section class="hero is-info is-medium">
        <div class="hero-body" style="background-image: url(https://npsyche.github.io/img/bg-blog.jpg);">
            <div class="container has-text-centered">
                <br>
                <h1 class="title is-size-1">
                    
                        #高并发
                    
                </h1>
                
            </div>
        </div>
    </section>


<div class="container">
    <div class="section">
    



<div class="columns">
    <div class="column is-9">
        <div class="tile is-child box">
            <div class="content">

                <article class="media">
                    <div class="media-content">
                        <div class="content">
                            <p class="title is-4"><a href="/2022/fastfast/">万级并发之linux内核tcp参数调优</a></p>
                            <p class="subtitle is-size-6 has-text-grey-light">
                                Published at April 29, 2022 &middot;
                                <i class="far fa-clock"></i>&nbsp;2 min read
                            </p>
                            <p>1.引言
对于网站经营者来说，让用户等待的时间过长，也许会造成毁灭性的后果。
我见过很多人为了享用某家特色小吃而在餐厅门口乐此不疲地排着长队，但没有听说有多少用户执着地等待着一个速度缓慢的站点而不去尝试别的站点。——《构建高性能web站点》
2.了解性能差异
了解性能差异：站在CPU的角度看世界
内容来源：http://cizixs.com/2017/01/03/how-slow-is-disk-and-network/
计算机不同组件速度差异金字塔见下图（不够直观）
越往上速度越快，容量越小，而价格越高。
​ 我们都知道CPU很快，硬盘很慢，那么站在CPU的角度，这些设备到底有多慢呢？见下方图表
​ 扩展阅读：
世界各地ping文时间：https://wondernetwork.com/pings/
​ 结论：磁盘和网络真的很慢，性能优化是个复杂的系统性的活。
3.记一次性能优化的过程
来自某接口需求，性能要求支撑万级TPS，10ms返回。
程序逻辑很简单，只是简单的k/v请求。
技术选型：
选用openresty容器（一个基于 Nginx 与Lua 的高性能 Web 平台），redis存储（毫无悬念），避免磁盘读取拖慢速度
服务器配置：
部署在同一区域（毫无悬念），减少不同城市网络访问。
8核，16G
服务稳定性要求：
线上服务没有返回时，将进入离线计算，调用端做了保护，因此就算服务崩了也没事，唯一关注：快！
因此大胆的作吧~
服务器内核参数调整：
ulimit -n 999999
重启失效
或：
在/etc/security/limits.conf加入一下内容
# 最大不能超过fs.nr_open值, 分别为单用户进程最大文件打开数，soft指软性限制,hard指硬性限制
# End of file
root soft nofile 999999
root hard nofile 999999
* soft nofile 999999
* hard nofile 999999
重启使上述内容生效
不愿意重启就使用以下命令
sysctl -p
然，并没有什么卵用。。。
wrk压力测试结果：上万并发，50%响应100多ms，90%响应200多ms，差了一个数量级
继续优化，还有什么需要考虑？
第一步，考虑优化web容器。
nginx参数优化...</p>
                        </div>
                    </div>
                </article>
                <br>

            </div>
        </div>
    </div>
    <div class="column is-3">
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Tags</h1>
        <div class="tags">
        
            <span class="tag"><a href="https://npsyche.github.io/tags/%E5%86%85%E6%A0%B8">内核</a></span>
        
            <span class="tag"><a href="https://npsyche.github.io/tags/%E8%B0%83%E4%BC%98">调优</a></span>
        
            <span class="tag"><a href="https://npsyche.github.io/tags/%E9%AB%98%E5%B9%B6%E5%8F%91">高并发</a></span>
        
        </div>          
    </div>
</div><br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Recent posts</h1>
        
            <h1><a href="https://npsyche.github.io/2022/fastfast/">万级并发之linux内核tcp参数调优</a></h1>
            <time class="has-text-grey-light is-size-7">29 April 2022</time>
        
            <h1><a href="https://npsyche.github.io/2022/20220426/">关于苏三</a></h1>
            <time class="has-text-grey-light is-size-7">26 April 2022</time>
        
    </div>
</div>
    <br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Archives</h1>
        
            <a href="https://npsyche.github.io/archives/2022">2022</a> (2)<br>
        
    </div>
</div>

    </div>
</div>


    </div>
</div>

<footer class="footer has-background-grey-darker has-text-white">
    <div class="content has-text-centered">
        <p>
            <span class="icon is-large"><a href="https://twitter.com/" class="mysocial" rel="me"><i class="fab fa-twitter fa-3x"></i></a></span>&nbsp;&nbsp;
            <span class="icon is-large"><a href="https://www.youtube.com/" class="mysocial" rel="me"><i class="fab fa-youtube fa-3x"></i></a></span>&nbsp;&nbsp;
            <span class="icon is-large"><a href="https://github.com/" class="mysocial" rel="me"><i class="fab fa-github fa-3x"></i></a></span>&nbsp;&nbsp;
            <br><br>
            Copyright &copy; 苏三个人技术博客 2022 - Theme by <a href="https://jeffprod.com" class="mysocial">JeffProd.com</a>
            - <a class="mysocial" href="https://npsyche.github.io/about">About</a>
        </p>
    </div>
</footer>

<script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>
</body>
</html>
